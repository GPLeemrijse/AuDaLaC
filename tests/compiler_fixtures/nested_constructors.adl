struct Node (dist : Int, in : Edge) {
    init {
        Edge e1 := Edge(Node(0, null), Node(-1, null), 1);
        Edge e2 := Edge(e1.s, e1.t, 2);
        Edge e3 := Edge(e1.s, Node(-1, null), 3);
        Edge e4 := Edge(e3.t, e1.s, 1);
    }
}

struct Edge (s : Node, t : Node, w: Nat) {
    race {
        if s.dist != -1 && (t.dist == -1 || s.dist + w < t.dist) then {
            t.in := this;
        }
    }
    compute {
        if t.in == this then {
            t.dist := s.dist + w;
        }
    }
}
init < Fix(race < compute) < Node.print